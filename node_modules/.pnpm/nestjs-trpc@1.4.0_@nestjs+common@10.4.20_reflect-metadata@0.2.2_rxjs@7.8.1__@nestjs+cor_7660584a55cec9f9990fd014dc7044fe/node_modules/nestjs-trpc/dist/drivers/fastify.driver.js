"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FastifyDriver = void 0;
const tslib_1 = require("tslib");
const common_1 = require("@nestjs/common");
const trpcFastify = require("@trpc/server/adapters/fastify");
let FastifyDriver = class FastifyDriver {
    async start(options, app, appRouter, contextInstance) {
        app.register(trpcFastify.fastifyTRPCPlugin, {
            prefix: options.basePath ?? '/trpc',
            trpcOptions: {
                router: appRouter,
                ...(options.context != null && contextInstance != null
                    ? {
                        createContext: (opts) => contextInstance.create(opts),
                    }
                    : {}),
            },
        });
    }
};
exports.FastifyDriver = FastifyDriver;
exports.FastifyDriver = FastifyDriver = tslib_1.__decorate([
    (0, common_1.Injectable)()
], FastifyDriver);
